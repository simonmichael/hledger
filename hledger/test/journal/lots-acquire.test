# Testing lot acquisition scenarios.

# * Lot acquisition

# ** 1. Simple acquire - positive amount to Asset account with cost basis - gets ptype:acquire tag
<
2026-01-01 Buy stock
    assets:broker     10 AAPL {$100}
    assets:cash      -$1000

$ hledger -f- print --verbose-tags
2026-01-01 Buy stock
    assets:broker    10 AAPL {$100}  ; ptype: acquire
    assets:cash              $-1000

>=

# ** 2. No cost basis (@ instead of {}) - not recognised
<
2026-01-04 Buy with @
    assets:broker     10 AAPL @ $100
    assets:cash      -$1000

$ hledger -f- print
2026-01-04 Buy with @
    assets:broker    10 AAPL @ $100
    assets:cash              $-1000

>=

# ** 3. Non-Asset account - should not be recognised even with cost basis
<
2026-01-05 Equity
    equity:conversion   10 AAPL {$100}
    assets:cash        -$1000

$ hledger -f- print
2026-01-05 Equity
    equity:conversion    10 AAPL {$100}
    assets:cash                  $-1000

>=

# ** 4. Cash accounts are recognised as asset accounts for lot classification.
<
commodity USDC  ; lots:
account assets:usdc  ; type: Cash

2026-01-06 Buy USDC
    assets:usdc       1000 USDC {$1}
    assets:cash     -$1000

$ hledger -f- print --verbose-tags
2026-01-06 Buy USDC
    assets:usdc    1000 USDC {$1}  ; ptype: acquire
    assets:cash            $-1000

>=

# ** 5. Account-level lots: tag also triggers lot classification.
<
account assets:broker  ; lots:

2026-01-07 Buy stock
    assets:broker     10 AAPL {$100}
    assets:cash     -$1000

$ hledger -f- print --verbose-tags
2026-01-07 Buy stock
    assets:broker    10 AAPL {$100}  ; ptype: acquire
    assets:cash              $-1000

>=

# ** 6. With --lots, acquired lots are displayed in their own subaccounts.
<
2026-01-15 buy
    assets:stocks    10 AAPL {$50}
    assets:checking

2026-02-01 buy more
    assets:stocks    5 AAPL {$55}
    assets:checking

$ hledger -f- bal assets:stocks --lots -N
             10 AAPL  assets:stocks:{2026-01-15, $50}
              5 AAPL  assets:stocks:{2026-02-01, $55}

# ** 7. Same-date acquisitions get labels added to ensure unique lot ids per commodity.
<
2026-01-15 buy morning
    assets:stocks    10 AAPL {$50}
    assets:checking

2026-01-15 buy afternoon
    assets:stocks    5 AAPL {$55}
    assets:checking

$ hledger -f- bal assets:stocks --lots -N
             10 AAPL  assets:stocks:{2026-01-15, "0001", $50}
              5 AAPL  assets:stocks:{2026-01-15, "0002", $55}

# ** 8. User-provided labels are preserved.
<
2026-01-15 buy
    assets:stocks    10 AAPL {$50} [2026-01-15] (morning-buy)
    assets:checking

$ hledger -f- bal assets:stocks --lots -N
             10 AAPL  assets:stocks:{2026-01-15, "morning-buy", $50}

# ** 9. User-provided labels resulting in non-unique lot ids are an error.
<
2026-01-15 buy first
    assets:stocks    10 AAPL {$50} (mybuy)
    assets:checking

2026-01-15 buy second
    assets:stocks    5 AAPL {$55} (mybuy)
    assets:checking

$ hledger -f- bal assets:stocks --lots
>2 /lot id is not unique/
>=1


