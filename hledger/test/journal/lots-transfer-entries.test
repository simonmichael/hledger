# Testing lot transfer journal entry variations, systematically.

# * Transfer

# ** With commodity/account not declared lotful

# *** 1. transfer: from {$50}, to costless basisless amount. Lot transfer detected.
<
2026-01-01 buy
    assets:broker1    10 AAPL {$50}
    assets:cash      -$500

2026-02-01 transfer
    assets:broker1   -10 AAPL {$50}
    assets:broker2    10 AAPL

$ hledger -f- print desc:transfer --lots --verbose-tags
2026-02-01 transfer
    assets:broker1:{2026-01-01, $50}    -10 AAPL {$50}  ; ptype: transfer-from
    assets:broker2:{2026-01-01, $50}           10 AAPL  ; ptype: transfer-to

>=

# *** 2. transfer: from {$50}, to {$50}, non-lotful commodity/account, non-asset. Not an asset, but we'll allow it here.
<
2026-01-01 buy
    assets:broker    10 AAPL {$50}
    assets:cash     -$500

2026-02-01 transfer
    assets:broker    -10 AAPL {$50}
    equity:opening    10 AAPL {$50}

$ hledger -f- print desc:transfer --lots --verbose-tags
2026-02-01 transfer
    assets:broker:{2026-01-01, $50}     -10 AAPL {$50} [2026-01-01]  ; ptype: transfer-from
    equity:opening:{2026-01-01, $50}     10 AAPL {$50} [2026-01-01]  ; ptype: transfer-to

>=

# *** 3. transfer: from {$50}, to {$50}, non-lotful commodity/account, asset.
<
2026-01-01 buy
    assets:broker1    10 AAPL {$50}
    assets:cash      -$500

2026-02-01 transfer
    assets:broker1   -10 AAPL {$50}
    assets:broker2    10 AAPL {$50}

$ hledger -f- print desc:transfer --lots --verbose-tags
2026-02-01 transfer
    assets:broker1:{2026-01-01, $50}    -10 AAPL {$50} [2026-01-01]  ; ptype: transfer-from
    assets:broker2:{2026-01-01, $50}     10 AAPL {$50} [2026-01-01]  ; ptype: transfer-to

>=

# ** With lotful commodity/account

# *** 4. transfer: from {$50}, to costless basisless amount. Lot transfer detected.
<
commodity AAPL  ; lots:

2026-01-01 buy
    assets:broker1    10 AAPL {$50}
    assets:cash      -$500

2026-02-01 transfer
    assets:broker1   -10 AAPL {$50}
    assets:broker2    10 AAPL

$ hledger -f- print desc:transfer --lots --verbose-tags
2026-02-01 transfer
    assets:broker1:{2026-01-01, $50}    -10 AAPL {$50}  ; ptype: transfer-from
    assets:broker2:{2026-01-01, $50}           10 AAPL  ; ptype: transfer-to

>=

# *** 5. transfer: from {$50}, to {}. Lot transfer detected.
<
commodity AAPL  ; lots:

2026-01-01 buy
    assets:broker1    10 AAPL {$50}
    assets:cash      -$500

2026-02-01 transfer
    assets:broker1   -10 AAPL {$50}
    assets:broker2    10 AAPL {}

$ hledger -f- print desc:transfer --lots --verbose-tags
2026-02-01 transfer
    assets:broker1:{2026-01-01, $50}    -10 AAPL {$50}  ; ptype: transfer-from
    assets:broker2:{2026-01-01, $50}        10 AAPL {}  ; ptype: transfer-to

>=

# *** 6. transfer: from {}, to {}. Lot transfer detected.
<
commodity AAPL  ; lots:

2026-01-01 buy
    assets:broker1    10 AAPL {$50}
    assets:cash      -$500

2026-02-01 transfer
    assets:broker1   -10 AAPL {}
    assets:broker2    10 AAPL {}

$ hledger -f- print desc:transfer --lots --verbose-tags
2026-02-01 transfer
    assets:broker1:{2026-01-01, $50}    -10 AAPL {$50} [2026-01-01]  ; ptype: transfer-from
    assets:broker2:{2026-01-01, $50}     10 AAPL {$50} [2026-01-01]  ; ptype: transfer-to

>=

# *** 7. transfer: from {$50}, to {$50}. Lot transfer detected.
<
commodity AAPL  ; lots:

2026-01-01 buy
    assets:broker1    10 AAPL {$50}
    assets:cash      -$500

2026-02-01 transfer
    assets:broker1   -10 AAPL {$50}
    assets:broker2    10 AAPL {$50}

$ hledger -f- print desc:transfer --lots --verbose-tags
2026-02-01 transfer
    assets:broker1:{2026-01-01, $50}    -10 AAPL {$50} [2026-01-01]  ; ptype: transfer-from
    assets:broker2:{2026-01-01, $50}     10 AAPL {$50} [2026-01-01]  ; ptype: transfer-to

>=

# *** 8. transfer: from {$50} @ $50, to {$50}. Error: unbalanced transaction.
<
commodity AAPL  ; lots:

2026-01-01 buy
    assets:broker1    10 AAPL {$50}
    assets:cash      -$500

2026-02-01 transfer
    assets:broker1   -10 AAPL {$50} @ $50
    assets:broker2    10 AAPL {$50}

$ hledger -f- print desc:transfer --lots --verbose-tags
>2 /transaction is unbalanced/
>=1

# *** 9. transfer: from {$50} @ $50, to {$50} @ $50. Error: lot transfers should have no transacted cost.
<
commodity AAPL  ; lots:

2026-01-01 buy
    assets:broker1    10 AAPL {$50}
    assets:cash      -$500

2026-02-01 transfer
    assets:broker1   -10 AAPL {$50} @ $50
    assets:broker2    10 AAPL {$50} @ $50

$ hledger -f- print desc:transfer --lots --verbose-tags
>2 /lot transfers should have no transacted cost/
>=1

# *** 10. transfer: from {$50}, to {$60} (mismatched). Error: does not match.
<
commodity AAPL  ; lots:

2026-01-01 buy
    assets:broker1    10 AAPL {$50}
    assets:cash      -$500

2026-02-01 transfer
    assets:broker1   -10 AAPL {$50}
    assets:broker2    10 AAPL {$60}

$ hledger -f- print desc:transfer --lots --verbose-tags
>2 /does not match transfer-to cost basis/
>=1
