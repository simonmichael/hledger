# * Cost basis ({}) on lot postings.
# Acquisitions in lotful commodities/accounts require explicit {} cost basis annotation.
# Transacted cost (@ @@) is inferred from cost basis for acquire postings, to help transaction balancing.

# ** 1. Explicit cost basis on lotful commodity is shown; transacted cost is inferred.
<
commodity AAPL   ; lots:

2024-01-01 buy stock
    assets:brokerage    10 AAPL {$100}
    assets:cash

$ hledger -f - print
2024-01-01 buy stock
    assets:brokerage    10 AAPL {$100}
    assets:cash

>=

# ** 2. Cost basis is not inferred without lots: tag.
<
commodity AAPL

2024-01-01 buy stock
    assets:brokerage    10 AAPL @ $100
    assets:cash

$ hledger -f - print
2024-01-01 buy stock
    assets:brokerage    10 AAPL @ $100
    assets:cash

>=

# ** 3. Cost basis is not inferred for negative amounts (dispose postings).
<
commodity AAPL   ; lots:

2024-01-01 sell stock
    assets:brokerage    -10 AAPL @ $150
    assets:cash

$ hledger -f - print
2024-01-01 sell stock
    assets:brokerage    -10 AAPL @ $150
    assets:cash

>=

# ** 4. Cost basis is not inferred when it has been explicitly recorded.
<
commodity AAPL   ; lots:

2024-01-01 buy stock
    assets:brokerage    10 AAPL {$95} @ $100
    assets:cash

$ hledger -f - print
2024-01-01 buy stock
    assets:brokerage    10 AAPL {$95} @ $100
    assets:cash

>=

# ** 5. Without explicit cost basis, a lotful commodity posting with @ is classified as acquire.
<
commodity AAPL   ; lots:

2024-01-01 buy stock
    assets:brokerage    10 AAPL @@ $1000
    assets:cash

$ hledger -f - print --verbose-tags
2024-01-01 buy stock
    assets:brokerage    10 AAPL @@ $1000  ; ptype: acquire
    assets:cash

>=

# # ** 0. Posting date is used for inferred cost basis date
# <
# commodity AAPL   ; lots:

# 2024-03-15 buy stock
#     assets:brokerage    10 AAPL @ $100  ; date:3/16
#     assets:cash

# $ hledger -f - print
# 2024-03-15 buy stock
#     assets:brokerage    10 AAPL @ $100 {$100} [2024-03-16]  ; date:3/16
#     assets:cash

# >=
